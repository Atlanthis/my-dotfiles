# #######################################################################################
# HYPRLAND CONFIG - OPTIMIZED FOR NVIDIA & WLOGOUT
# #######################################################################################

################
### MONITORS ###
################

monitor=eDP-1, 1920x1080@60, 0x0, 1
monitor=HDMI-A-2, 1920x1080@144, 1920x0, 1

workspace=1, monitor:eDP-1
workspace=2, monitor:eDP-1
workspace=3, monitor:HDMI-A-2
workspace=4, monitor:HDMI-A-2

###################
### MY PROGRAMS ###
###################

$terminal = foot
$fileManager = thunar
$menu = rofi -show drun -theme ~/.config/rofi/my_theme.rasi
$browser = firefox 

#################
### AUTOSTART ###
#################

exec-once = waybar &
exec-once = nm-applet --indicator &
exec-once = rm -rf ~/.nv/GLCache
exec-once = swww-daemon --format xrgb &
#exec-once = sleep 3 && fish ~/change_wallpaper.sh
exec-once = hyprpm reload -n
exec-once = waypaper --restore
exec-once = pypr

# В раздел автозагрузки (exec-once)
exec-once = rclone mount onedrive: ~/OneDrive --vfs-cache-mode full

#############################
### ENVIRONMENT VARIABLES ###
#############################

env = XCURSOR_SIZE,24
env = HYPRCURSOR_SIZE,24

# NVIDIA & Wayland Backend Setup
env = LIBVA_DRIVER_NAME,nvidia
env = XDG_SESSION_TYPE,wayland
env = GBM_BACKEND,nvidia-drm
env = __GLX_VENDOR_LIBRARY_NAME,nvidia
#env = WLR_DRM_NO_ATOMIC,1
env = NVD_BACKEND,direct
env = QT_QPA_PLATFORMTHEME,qt6ct
env = QT_WAYLAND_DISABLE_WINDOWDECORATION,1
env = __GL_GSYNC_ALLOWED,0
env = __GL_VRR_ALLOWED,0
env = NV_REQ_sRGB_REPORT_CAPABLE,1
env = MOZ_ENABLE_WAYLAND,1

# Ozone/Electron fix (для Brave, Discord и т.д.)
env = ELECTRON_OZONE_PLATFORM_HINT,auto

#####################
### LOOK AND FEEL ###
#####################

general {
    gaps_in = 3
    gaps_out = 5
    border_size = 2
    col.active_border = rgba(33ccffee) rgba(00ff99ee) 45deg
    col.inactive_border = rgba(595959aa)
    resize_on_border = false
    allow_tearing = false
    layout = dwindle
}

decoration {
    rounding = 10
    active_opacity = 0.85
    inactive_opacity = 0.75

    shadow {
        enabled = true
        range = 4
        render_power = 3
        color = rgba(1a1a1aee)
    }

    blur {
        enabled = true
        size = 6
        passes = 2
        vibrancy = 0.1696
    }
}
blurls = waybar
blurls = rofi
blurls = notifications

animations {
    enabled = yes
    bezier = fluent_decel, 0.1, 1, 0, 1
    bezier = easeOutExpo, 0.16, 1, 0.3, 1
    bezier = soft_bounce, 0.05, 0.9, 0.1, 1.05

    animation = windows, 1, 3, fluent_decel, slide
    animation = windowsOut, 1, 3, fluent_decel, slide
    animation = border, 1, 10, default
    animation = borderangle, 1, 8, default
    animation = fade, 1, 7, default
    animation = workspaces, 1, 4, easeOutExpo, slide
    animation = layers, 1, 3, soft_bounce, fade
    animation = windowsMove, 1, 5, soft_bounce
    animation = specialWorkspace, 1, 3, default, slidevert
}

dwindle {
    pseudotile = true
    preserve_split = true
}

misc {
    force_default_wallpaper = 0
    disable_hyprland_logo = true
}

#############
### INPUT ###
#############

input {
    kb_layout = us,ru
    kb_options = grp:win_space_toggle
    follow_mouse = 1
    sensitivity = 0
    touchpad {
        natural_scroll = false
    }
}

###################
### KEYBINDINGS ###
###################

$mainMod = SUPER

bind = $mainMod, Return, exec, $terminal
bind = $mainMod, Q, killactive,
# Вызов wlogout (меню питания)
bind = $mainMod, M, exec, wlogout
bind = $mainMod, E, exec, $fileManager
bind = $mainMod, V, togglefloating
bind = $mainMod, V, centerwindow
bind = $mainMod, D, exec, $menu
bind = $mainMod, B, exec, $browser
bind = SUPER, T, exec, foot -e dots
bind = SUPER, W, exec, waypaper
bind = SUPER, S, exec, pypr toggle spotify

# Режим изменения размера (Win+R)
bind = $mainMod, R, submap, resize
submap = resize
binde = , right, resizeactive, 20 0
binde = , left, resizeactive, -20 0
binde = , up, resizeactive, 0 -20
binde = , down, resizeactive, 0 20
bind = , escape, submap, reset 
bind = , return, submap, reset 
submap = reset

# Fullscreen & Focus
bind = $mainMod, F, fullscreen, 0
bind = $mainMod, left, movefocus, l
bind = $mainMod, right, movefocus, r
bind = $mainMod, up, movefocus, u
bind = $mainMod, down, movefocus, d
# Сделать окно на весь экран без перекрытия панелей (Maximize)
bind = $mainMod CTRL, F, fullscreenstate, 1 0

# Workspaces
bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4

# Move to Workspaces
bind = $mainMod SHIFT, 1, movetoworkspace, 1
bind = $mainMod SHIFT, 2, movetoworkspace, 2
bind = $mainMod SHIFT, 3, movetoworkspace, 3
bind = $mainMod SHIFT, 4, movetoworkspace, 4

# Перемещение окон внутри воркспейса (Win + Ctrl + Стрелки)
bind = $mainMod CTRL, left, movewindow, l
bind = $mainMod CTRL, right, movewindow, r
bind = $mainMod CTRL, up, movewindow, u
bind = $mainMod CTRL, down, movewindow, d

# Перемещение окна на другой монитор (Win + Shift + стрелки влево/вправо)
bind = $mainMod SHIFT, left, movewindow, mon:eDP-1
bind = $mainMod SHIFT, right, movewindow, mon:HDMI-A-2

# Перезагрузка конфига Hyprland
bind = $mainMod SHIFT, R, exec, hyprctl reload


# ScreenShots
bind = , Print, exec, grim -g "$(slurp)" - | wl-copy

# Volume & Brightness
bindel = ,XF86AudioRaiseVolume, exec, wpctl set-volume -l 1 @DEFAULT_AUDIO_SINK@ 5%+
bindel = ,XF86AudioLowerVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
bindel = ,XF86AudioMute, exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bindel = ,XF86MonBrightnessUp, exec, brightnessctl set 5%+
bindel = ,XF86MonBrightnessDown, exec, brightnessctl set 5%-


# $mainModt + Левая кнопка мыши: если просто кликнуть — окно станет плавающим.
# Если зажать и потянуть — оно будет перемещаться.
bindm = $mainMod, mouse:272, movewindow
bindc = $mainModT, mouse:272, togglefloating,

# Перемещение окна зажатым Super + Левая кнопка мыши
bindm = $mainMod, mouse:272, movewindow

# Ресайз окна зажатым Super + Правая кнопка мыши
bindm = $mainMod, mouse:273, resizewindow

bind = $mainMod, T, settiled,

##############################
### WINDOWS AND WORKSPACES ###
##############################

windowrule {
    name = rofi-style
    match:class = ^(rofi)$
    float = on
    center = on
    # Включаем принудительную прозрачность, раз это поддерживается
    opacity = 0.85 0.85
}

windowrule {
    name = ^(spotify)$
    float = true
    workspace = special:scratchpad silent
    opacity = 0.90
}

windowrule {
    name = wlogout-style
    match:class = ^(wlogout)$
    fullscreen = on
    idle_inhibit = focus
}
    #################
    ###  PLUGINS  ###
    #################
    
    plugin {
        hyprexpo {
            columns = 3
            gap_size = 5
            bg_col = rgb(111111)
            workspace_method = center current # [center/first] [none/all/current]
        }
    }
    
    bind = ALT, tab, hyprexpo:expo, toggle
    
    #################
    ###   MISC    ###
    #################
    
    misc {
        vfr = true
    }
    
    #################
    ###  CURSOR   ###
    #################
    
    cursor {
        no_hardware_cursors = true
    }
